<div class="power-datetime-picker"  {{did-insert (action "didInsert")}} ...attributes>
  <BasicDropdown
    @renderInPlace={{true}}
    @onClose={{action "checkDateInputFocus"}}
    as |dropdown|
  >
    <dropdown.Trigger
      @eventType="mousedown"
      onmousedown={{action "onTriggerFocus"}}
      class={{@triggerWrapperClass}}
      ariaLabelledBy={{@ariaLabelledBy}}
      aria-label={{@ariaLabel}}
    >
      {{#if @value}}
        <button
          type="button"
          class="{{@clearDateTimeButtonClass}}"
          data-test-id="datetime-picker-clear-datetime"
          onclick={{action "clearDateTime"}}
        >Ã—</button>
      {{else}}
        <div class="{{@calendarIconClass}}"></div>
      {{/if}}
      <input
        type="text"
        value={{if
          @value
          (ember-changeset-webforms/moment-format
            (ember-changeset-webforms/moment @value this.parsedDateTimeFormat)
            this.parsedDateTimeDisplayFormat
          )
        }}
        placeholder={{this.parsedDatepickerPlaceholder}}
        onChange={{action "onDateInputChange"}}
        onKeyUp={{action "onDateInputKeyUp"}}
        onFocus={{action "onDateInputFocus"}}
        onBlur={{action "onDateInputBlur"}}
        class={{@triggerInputClass}}
        id={{@triggerInputId}}
        data-test-id="power-datepicker-input"
      />
    </dropdown.Trigger>
    <dropdown.Content
      data-test-id="ecw-power-datepicker-dropdown"
      class={{@dropdownClass}}
    >
      <div class={{@dropdownInnerClass}}>
        <PowerCalendar
          @minDate={{@minDate}}
          @maxDate={{@maxDate}}
          @selected={{this.selectedDate}}
          @onSelect={{action "dateClicked" dropdown}}
          @onCenterChange={{action (mut this.center) value="date"}}
          @center={{this.center}}
          class={{@calendarClass}}
          as |calendar|
        >
          <Background::PowerCalendarNav
            @calendar={{calendar}}
            @calendarTitleFormat={{@calendarTitleFormat}}
            @moveCenter={{action calendar.actions.moveCenter}}
            class={{@calendarNavClass}}
          />
          <calendar.Days
            @minDate={{@minDate}}
            @maxDate={{@maxDate}}
            class={{@calendarDaysClass}}
          />
        </PowerCalendar>
        {{#if (and @showTimeSelector @value (not @fixedTime))}}
          <div
            data-test-id="time-selector"
            class="time-select
              {{unless @value 'disabled'}}
              {{@timeSelectorContainerClass}}"
          >
            {{#each this.timeFormatParts as |timeFormatPart|}}
              <div
                data-test-class="time-selector-field"
                data-test-id="time-selector-field-{{timeFormatPart.type}}"
                class="time-selector-field time-selector-field-{{timeFormatPart.type}}"
              >
                <label
                  for="time-selector-{{timeFormatPart.type}}"
                  data-test-class="time-selector-field-label"
                  data-test-id="time-selector-field-label-{{timeFormatPart.type}}"
                  class={{@timeInputLabelClass}}
                >{{timeFormatPart.label}}</label>
                <input
                  id="time-selector-{{timeFormatPart.type}}"
                  data-test-class="time-selector-field-input"
                  data-test-id="time-selector-field-input-{{timeFormatPart.type}}"
                  type="number"
                  max={{timeFormatPart.max}}
                  min={{timeFormatPart.min}}
                  value={{readonly
                    (if
                      @value
                      (ember-changeset-webforms/moment-format
                        (ember-changeset-webforms/moment
                          @value this.parsedDateTimeFormat
                        )
                        timeFormatPart.formatChar
                      )
                    )
                  }}
                  onChange={{action "setTime" timeFormatPart.formatChar}}
                  onKeyDown={{action
                    "onKeyDownTimeUnitInput"
                    timeFormatPart.formatChar
                  }}
                  onKeyUp={{action
                    "onKeyUpTimeUnitInput"
                    timeFormatPart.formatChar
                  }}
                  class="time-selector-field-input-{{timeFormatPart.type}}
                    {{@timeInputClass}}"
                />
              </div>
            {{/each}}
            {{#if this.showAmPmInput}}
              <div>
                <label
                  for="time-selector-am-pm"
                  data-test-class="time-selector-field-label"
                  data-test-id="time-selector-field-label-am-pm"
                  class={{@timeInputLabelClass}}
                >{{@timeInputLabels.amPm}}</label>
                <input
                  type="text"
                  id="time-selector-am-pm"
                  value={{if
                    @value
                    (ember-changeset-webforms/moment-format
                      (ember-changeset-webforms/moment
                        @value this.parsedDateTimeFormat
                      )
                      "a"
                    )
                  }}
                  onChange={{action "onChangeAmPm"}}
                  onFocus={{action "onFocusInAmPm"}}
                  onBlur={{action "onChangeAmPm"}}
                  onKeyUp={{action "onKeyUpAmPm"}}
                  data-test-id="power-datepicker-am-pm-input"
                  class={{@timeInputClass}}
                />
              </div>
            {{/if}}
          </div>
        {{/if}}
      </div>
    </dropdown.Content>
  </BasicDropdown>
</div>