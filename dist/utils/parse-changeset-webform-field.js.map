{"version":3,"file":"parse-changeset-webform-field.js","sources":["../../src/utils/parse-changeset-webform-field.js"],"sourcesContent":["import FormField from './form-field';\nimport { typeOf as emberTypeOf } from '@ember/utils';\nimport Option from './option-class';\nimport safeName from './safe-name';\n\nexport default function parseChangesetWebformField(\n  field,\n  customValidators,\n  formSettings,\n) {\n  if (!field) {\n    return;\n  }\n  if (!field.fieldId) {\n    throw Error(\n      `[Ember validating field] fieldId is a required field for each field in a validating form.`,\n    );\n  }\n  const parsedField = parse(field, customValidators, formSettings);\n  return new FormField(parsedField);\n}\n\nfunction parse(fieldSchema, customValidators, formSettings) {\n  let field = { ...fieldSchema };\n  if (field.validationRules) {\n    var requiredRule = field.validationRules.find(function (rule) {\n      return (\n        rule.validationMethod === 'validatePresence' &&\n        (rule.arguments === true || rule.arguments.presence === true)\n      );\n    });\n    if (requiredRule) {\n      field.required = true;\n    }\n  }\n\n  if (field.cloneFieldSchema) {\n    field.cloneGroupName = field.fieldId;\n    field.cloneGroupNumber = 0;\n    field.cloneFieldSchema.fieldId = field.fieldId;\n    field.clonedFieldBlueprint = parse(\n      field.cloneFieldSchema,\n      customValidators,\n      formSettings,\n    );\n  }\n\n  if (field.options) {\n    field.options = field.options.map(function (option) {\n      if (emberTypeOf(option) === 'object') {\n        return new Option(option);\n      }\n      return option;\n    });\n  }\n\n  if ((field.cloneFieldSchema || {}).validationRules) {\n    field.validationRules = field.validationRules || [];\n    field.validationRules.unshift({\n      validationMethod: 'validateClone',\n      arguments: {\n        validationRules: field.cloneFieldSchema.validationRules,\n        customValidators: customValidators,\n      },\n    });\n    field.clonedFieldBlueprint.validatesOn.forEach((event) => {\n      const skip = ['submit', 'removeClone'];\n      if (skip.indexOf(event) > -1) {\n        return;\n      }\n      if (\n        !field.validatesOn.find((fieldEvent) => fieldEvent === `${event}Clone`)\n      ) {\n        field.validatesOn.push(`${event}Clone`);\n      }\n    });\n  }\n  field.validates = field.validationRules.length > 0 ? true : false;\n  // TODO get rid of fieldId\n  field.validatesOn = (field.validatesOn || []).concat(\n    field.alwaysValidateOn || [],\n  );\n  field.name =\n    field.name ||\n    safeName(`${formSettings.formName}-form-${field.fieldId}-field`);\n  field.id =\n    field.id ||\n    safeName(`${formSettings.formName}-form-${field.fieldId}-field`);\n  field.placeholder = field.placeholder || field.fieldLabel;\n  field.propertyName = field.propertyName || field.fieldId;\n\n  field = field.customParser ? field.customParser(field) : field;\n  delete field.alwaysValidateOn;\n  delete field.cloneFieldSchema;\n  return field;\n}\n"],"names":["parseChangesetWebformField","field","customValidators","formSettings","fieldId","Error","parsedField","parse","FormField","fieldSchema","validationRules","requiredRule","find","rule","validationMethod","arguments","presence","required","cloneFieldSchema","cloneGroupName","cloneGroupNumber","clonedFieldBlueprint","options","map","option","emberTypeOf","Option","unshift","validatesOn","forEach","event","skip","indexOf","fieldEvent","push","validates","length","concat","alwaysValidateOn","name","safeName","formName","id","placeholder","fieldLabel","propertyName","customParser"],"mappings":";;;;;AAKe,SAASA,0BAA0BA,CAChDC,KAAK,EACLC,gBAAgB,EAChBC,YAAY,EACZ;EACA,IAAI,CAACF,KAAK,EAAE;AACV,IAAA;AACF;AACA,EAAA,IAAI,CAACA,KAAK,CAACG,OAAO,EAAE;IAClB,MAAMC,KAAK,CACR,CAAA,yFAAA,CACH,CAAC;AACH;EACA,MAAMC,WAAW,GAAGC,KAAK,CAACN,KAAK,EAAEC,gBAAgB,EAAEC,YAAY,CAAC;AAChE,EAAA,OAAO,IAAIK,SAAS,CAACF,WAAW,CAAC;AACnC;AAEA,SAASC,KAAKA,CAACE,WAAW,EAAEP,gBAAgB,EAAEC,YAAY,EAAE;AAC1D,EAAA,IAAIF,KAAK,GAAG;IAAE,GAAGQ;GAAa;EAC9B,IAAIR,KAAK,CAACS,eAAe,EAAE;IACzB,IAAIC,YAAY,GAAGV,KAAK,CAACS,eAAe,CAACE,IAAI,CAAC,UAAUC,IAAI,EAAE;AAC5D,MAAA,OACEA,IAAI,CAACC,gBAAgB,KAAK,kBAAkB,KAC3CD,IAAI,CAACE,SAAS,KAAK,IAAI,IAAIF,IAAI,CAACE,SAAS,CAACC,QAAQ,KAAK,IAAI,CAAC;AAEjE,KAAC,CAAC;AACF,IAAA,IAAIL,YAAY,EAAE;MAChBV,KAAK,CAACgB,QAAQ,GAAG,IAAI;AACvB;AACF;EAEA,IAAIhB,KAAK,CAACiB,gBAAgB,EAAE;AAC1BjB,IAAAA,KAAK,CAACkB,cAAc,GAAGlB,KAAK,CAACG,OAAO;IACpCH,KAAK,CAACmB,gBAAgB,GAAG,CAAC;AAC1BnB,IAAAA,KAAK,CAACiB,gBAAgB,CAACd,OAAO,GAAGH,KAAK,CAACG,OAAO;AAC9CH,IAAAA,KAAK,CAACoB,oBAAoB,GAAGd,KAAK,CAChCN,KAAK,CAACiB,gBAAgB,EACtBhB,gBAAgB,EAChBC,YACF,CAAC;AACH;EAEA,IAAIF,KAAK,CAACqB,OAAO,EAAE;IACjBrB,KAAK,CAACqB,OAAO,GAAGrB,KAAK,CAACqB,OAAO,CAACC,GAAG,CAAC,UAAUC,MAAM,EAAE;AAClD,MAAA,IAAIC,MAAW,CAACD,MAAM,CAAC,KAAK,QAAQ,EAAE;AACpC,QAAA,OAAO,IAAIE,MAAM,CAACF,MAAM,CAAC;AAC3B;AACA,MAAA,OAAOA,MAAM;AACf,KAAC,CAAC;AACJ;EAEA,IAAI,CAACvB,KAAK,CAACiB,gBAAgB,IAAI,EAAE,EAAER,eAAe,EAAE;AAClDT,IAAAA,KAAK,CAACS,eAAe,GAAGT,KAAK,CAACS,eAAe,IAAI,EAAE;AACnDT,IAAAA,KAAK,CAACS,eAAe,CAACiB,OAAO,CAAC;AAC5Bb,MAAAA,gBAAgB,EAAE,eAAe;AACjCC,MAAAA,SAAS,EAAE;AACTL,QAAAA,eAAe,EAAET,KAAK,CAACiB,gBAAgB,CAACR,eAAe;AACvDR,QAAAA,gBAAgB,EAAEA;AACpB;AACF,KAAC,CAAC;IACFD,KAAK,CAACoB,oBAAoB,CAACO,WAAW,CAACC,OAAO,CAAEC,KAAK,IAAK;AACxD,MAAA,MAAMC,IAAI,GAAG,CAAC,QAAQ,EAAE,aAAa,CAAC;MACtC,IAAIA,IAAI,CAACC,OAAO,CAACF,KAAK,CAAC,GAAG,EAAE,EAAE;AAC5B,QAAA;AACF;AACA,MAAA,IACE,CAAC7B,KAAK,CAAC2B,WAAW,CAAChB,IAAI,CAAEqB,UAAU,IAAKA,UAAU,KAAM,CAAA,EAAEH,KAAM,CAAA,KAAA,CAAM,CAAC,EACvE;QACA7B,KAAK,CAAC2B,WAAW,CAACM,IAAI,CAAE,CAAEJ,EAAAA,KAAM,OAAM,CAAC;AACzC;AACF,KAAC,CAAC;AACJ;AACA7B,EAAAA,KAAK,CAACkC,SAAS,GAAGlC,KAAK,CAACS,eAAe,CAAC0B,MAAM,GAAG,CAAC,GAAG,IAAI,GAAG,KAAK;AACjE;AACAnC,EAAAA,KAAK,CAAC2B,WAAW,GAAG,CAAC3B,KAAK,CAAC2B,WAAW,IAAI,EAAE,EAAES,MAAM,CAClDpC,KAAK,CAACqC,gBAAgB,IAAI,EAC5B,CAAC;AACDrC,EAAAA,KAAK,CAACsC,IAAI,GACRtC,KAAK,CAACsC,IAAI,IACVC,QAAQ,CAAE,CAAErC,EAAAA,YAAY,CAACsC,QAAS,CAAA,MAAA,EAAQxC,KAAK,CAACG,OAAQ,QAAO,CAAC;AAClEH,EAAAA,KAAK,CAACyC,EAAE,GACNzC,KAAK,CAACyC,EAAE,IACRF,QAAQ,CAAE,CAAErC,EAAAA,YAAY,CAACsC,QAAS,CAAA,MAAA,EAAQxC,KAAK,CAACG,OAAQ,QAAO,CAAC;EAClEH,KAAK,CAAC0C,WAAW,GAAG1C,KAAK,CAAC0C,WAAW,IAAI1C,KAAK,CAAC2C,UAAU;EACzD3C,KAAK,CAAC4C,YAAY,GAAG5C,KAAK,CAAC4C,YAAY,IAAI5C,KAAK,CAACG,OAAO;AAExDH,EAAAA,KAAK,GAAGA,KAAK,CAAC6C,YAAY,GAAG7C,KAAK,CAAC6C,YAAY,CAAC7C,KAAK,CAAC,GAAGA,KAAK;EAC9D,OAAOA,KAAK,CAACqC,gBAAgB;EAC7B,OAAOrC,KAAK,CAACiB,gBAAgB;AAC7B,EAAA,OAAOjB,KAAK;AACd;;;;"}