{"version":3,"file":"form-field.js","sources":["../../src/utils/form-field.js"],"sourcesContent":["import { tracked } from '@glimmer/tracking';\nexport default class FormField {\n  @tracked cloneCountStatus;\n  @tracked clonedFields;\n  @tracked eventLog = [];\n  @tracked focussed;\n  @tracked changeset;\n  @tracked validatesOn = [];\n  // @tracked wasValidated;\n  // BEGIN-SNIPPET field-settings-tracked-props.js\n  @tracked hidden;\n  @tracked disabled;\n  @tracked hideValidation;\n  // END-SNIPPET\n  constructor(args) {\n    for (const key in args) {\n      this[key] = args[key];\n    }\n  }\n\n  get fieldValue() {\n    return this.changeset.get(this.fieldId);\n  }\n\n  get validationErrors() {\n    return this.changeset.get(`error.${this.fieldId}.validation`) || [];\n  }\n\n  get masterFormFieldValidationErrors() {\n    const masterFormFieldValidationErrors = this.validationErrors.filter(\n      (item) => {\n        return typeof item !== 'object' || !item.clones;\n      },\n    );\n    return masterFormFieldValidationErrors;\n  }\n\n  get eventLogValidated() {\n    return this.validatesOn.filter((eventName) =>\n      this.eventLog.includes(eventName),\n    );\n  }\n\n  get wasValidated() {\n    if (!this.validates) {\n      return null;\n    }\n    if (this.hideValidation) {\n      return null;\n    }\n    if (!this.showValidationWhenFocussed && this.focussed) {\n      return null;\n    }\n    if (!this.eventLogValidated.length) {\n      return null;\n    }\n    return true;\n  }\n\n  get validationStatus() {\n    if (!this.wasValidated) {\n      return null;\n    }\n    if (this.validationErrors.length === 0) {\n      return 'valid';\n    } else {\n      return 'invalid';\n    }\n  }\n\n  get dynamicallyExcluded() {\n    if (!this.dynamicIncludeExclude) {\n      return null;\n    }\n    let result =\n      this.dynamicIncludeExclude.default === 'exclude' ? true : false;\n    if (\n      this.overrideConditionsFulfilled(\n        this.dynamicIncludeExclude.toggleDefault,\n        this.changeset,\n      )\n    ) {\n      result = !result;\n    }\n    return result;\n  }\n\n  checkCondition(changeset, condition) {\n    const value = changeset.get(condition.fieldId); // Needs to use propertyName or better yet, fieldValue\n\n    if (condition.valueEquals && (!value || value !== condition.valueEquals)) {\n      return false;\n    }\n    if (\n      condition.valueLengthEq &&\n      (!value || value.length !== condition.valueLengthEq)\n    ) {\n      return false;\n    }\n    if (\n      condition.valueLengthLt &&\n      (!value || !(value.length < condition.valueLengthLt))\n    ) {\n      return false;\n    }\n    if (\n      condition.valueLengthLte &&\n      (!value || !(value.length <= condition.valueLengthLte))\n    ) {\n      return false;\n    }\n    if (\n      condition.valueLengthGt &&\n      (!value || !(value.length > condition.valueLengthGt))\n    ) {\n      return false;\n    }\n    if (\n      condition.valueLengthGte &&\n      (!value || !(value.length >= condition.valueLengthGte))\n    ) {\n      return false;\n    }\n\n    if (\n      condition.valueIncludes &&\n      (!value || !value.includes(condition.valueIncludes))\n    ) {\n      return false;\n    }\n    if (\n      condition.valueExcludes &&\n      (!value || value.includes(condition.valueExcludes)) // Should valueExcludes be true if value is null or undefined?\n    ) {\n      return false;\n    }\n    return true;\n  }\n\n  checkConditions(ruleSet, changeset) {\n    const results = ruleSet.conditions.map((condition) => {\n      if (condition.conditions) {\n        return this.checkConditions(condition, changeset);\n      }\n      return this.checkCondition(changeset, condition);\n    });\n    if (ruleSet.ruleType === 'allConditionsTrue') {\n      return results.includes(false) ? false : true;\n    } else if (ruleSet.ruleType === 'anyConditionsTrue') {\n      return results.includes(true) ? true : false;\n    }\n  }\n\n  overrideConditionsFulfilled(ruleSet, changeset) {\n    const results = this.checkConditions(ruleSet, changeset);\n    return results;\n  }\n\n  updateValue(value) {\n    this.eventLog.push('valueUpdated');\n    var changeset = this.changeset;\n    this.previousValue = changeset.get(this.propertyName);\n    changeset.set(this.propertyName, value);\n    this.validate();\n  }\n\n  validate() {\n    return new Promise((resolve, reject) => {\n      const formField = this;\n      const changeset = this.changeset;\n      if (!formField.validates) {\n        return;\n      }\n      if (!this.eventLogValidated.length) {\n        return;\n      }\n      changeset\n        .validate(formField.propertyName)\n        .then(() => {\n          // formField.wasValidated = true;\n          const fieldValidationErrors = changeset.error[formField.propertyName];\n          resolve(fieldValidationErrors);\n        })\n        .catch((err) => {\n          reject(err);\n        });\n    });\n  }\n}\n"],"names":["FormField","g","prototype","tracked","i","void 0","constructor","args","key","fieldValue","changeset","get","fieldId","validationErrors","masterFormFieldValidationErrors","filter","item","clones","eventLogValidated","validatesOn","eventName","eventLog","includes","wasValidated","validates","hideValidation","showValidationWhenFocussed","focussed","length","validationStatus","dynamicallyExcluded","dynamicIncludeExclude","result","default","overrideConditionsFulfilled","toggleDefault","checkCondition","condition","value","valueEquals","valueLengthEq","valueLengthLt","valueLengthLte","valueLengthGt","valueLengthGte","valueIncludes","valueExcludes","checkConditions","ruleSet","results","conditions","map","ruleType","updateValue","push","previousValue","propertyName","set","validate","Promise","resolve","reject","formField","then","fieldValidationErrors","error","catch","err"],"mappings":"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"}