{"version":3,"file":"validating-clone.js","sources":["../../../../src/components/ember-changeset-webforms/cloned-field-elements/validating-clone.js"],"sourcesContent":["import { action } from '@ember/object';\nimport Component from '@glimmer/component';\nimport { tracked } from '@glimmer/tracking';\nexport default class ValidatingClone extends Component {\n  @action\n  didInsert() {\n    var changeset = this.args.changesetWebform.changeset;\n    if (\n      changeset.get(this.args.masterFormField.propertyName)[\n        this.args.clonedFormField.index\n      ]\n    ) {\n      this.args.clonedFormField.eventLog.push('insert');\n      this.args.masterFormField.eventLog.push('insertClone');\n      this.args.clonedFormField.updateValidationActivation();\n      this.args.validateField(this.args.masterFormField);\n    }\n  }\n\n  @action\n  onUserInteractionClone(eventName, value, event) {\n    if (this.isDestroyed || this.isDestroying) {\n      return;\n    }\n    const clonedFormField = this.args.clonedFormField;\n    if (eventName === 'focusOut') {\n      clonedFormField.focussed = false;\n    } else if (eventName === 'focusIn') {\n      clonedFormField.focussed = true;\n    }\n    clonedFormField.eventLog.push(eventName);\n    this.args.masterFormField.eventLog.push(`${eventName}Clone`);\n    clonedFormField.updateValidationActivation();\n    this.args.onUserInteraction(`${eventName}Clone`);\n  }\n\n  @action\n  updateCloneValue(value) {\n    const clonedFormField = this.args.clonedFormField;\n    this.args.clonedFormField.eventLog.push('valueUpdated');\n    this.args.masterFormField.eventLog.push('valueUpdatedClone');\n    clonedFormField.updateValidationActivation();\n    this.args.updateFieldValue(\n      this.updatedGroupValue(\n        value,\n        clonedFormField.index,\n        this.args.masterFormField,\n      ),\n      this.args.masterFormField,\n    );\n  }\n\n  updatedGroupValue(value, index, masterFormField) {\n    var groupValue =\n      this.args.changesetWebform.changeset.get(masterFormField.propertyName) ||\n      [];\n    if (groupValue[index] === value) {\n      return groupValue; // TODO tests // Because if groupValue is an array of models, and itself a model property, you get this error: \"You can only 'replaceRelatedRecord' on a belongsTo relationship. *** is a hasMany\". In the case, the field should have updated the value by now anyway.\n    }\n    masterFormField.lastUpdatedClone = {\n      index: index,\n      previousValue: groupValue[index],\n      previousLength: groupValue.length,\n    };\n\n    groupValue[index] = value;\n    return groupValue;\n  }\n}\n"],"names":["ValidatingClone","Component","didInsert","changeset","args","changesetWebform","get","masterFormField","propertyName","clonedFormField","index","eventLog","push","updateValidationActivation","validateField","n","prototype","action","onUserInteractionClone","eventName","value","event","isDestroyed","isDestroying","focussed","onUserInteraction","updateCloneValue","updateFieldValue","updatedGroupValue","groupValue","lastUpdatedClone","previousValue","previousLength","length","setComponentTemplate","TEMPLATE"],"mappings":";;;;;;;;;AAGe,MAAMA,eAAe,SAASC,SAAS,CAAC;AAErDC,EAAAA,SAASA,GAAG;IACV,IAAIC,SAAS,GAAG,IAAI,CAACC,IAAI,CAACC,gBAAgB,CAACF,SAAS;IACpD,IACEA,SAAS,CAACG,GAAG,CAAC,IAAI,CAACF,IAAI,CAACG,eAAe,CAACC,YAAY,CAAC,CACnD,IAAI,CAACJ,IAAI,CAACK,eAAe,CAACC,KAAK,CAChC,EACD;MACA,IAAI,CAACN,IAAI,CAACK,eAAe,CAACE,QAAQ,CAACC,IAAI,CAAC,QAAQ,CAAC;MACjD,IAAI,CAACR,IAAI,CAACG,eAAe,CAACI,QAAQ,CAACC,IAAI,CAAC,aAAa,CAAC;AACtD,MAAA,IAAI,CAACR,IAAI,CAACK,eAAe,CAACI,0BAA0B,EAAE;MACtD,IAAI,CAACT,IAAI,CAACU,aAAa,CAAC,IAAI,CAACV,IAAI,CAACG,eAAe,CAAC;AACpD;AACF;AAAC,EAAA;IAAAQ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,WAAA,EAAA,CAbAC,MAAM,CAAA,CAAA;AAAA;AAgBPC,EAAAA,sBAAsBA,CAACC,SAAS,EAAEC,KAAK,EAAEC,KAAK,EAAE;AAC9C,IAAA,IAAI,IAAI,CAACC,WAAW,IAAI,IAAI,CAACC,YAAY,EAAE;AACzC,MAAA;AACF;AACA,IAAA,MAAMd,eAAe,GAAG,IAAI,CAACL,IAAI,CAACK,eAAe;IACjD,IAAIU,SAAS,KAAK,UAAU,EAAE;MAC5BV,eAAe,CAACe,QAAQ,GAAG,KAAK;AAClC,KAAC,MAAM,IAAIL,SAAS,KAAK,SAAS,EAAE;MAClCV,eAAe,CAACe,QAAQ,GAAG,IAAI;AACjC;AACAf,IAAAA,eAAe,CAACE,QAAQ,CAACC,IAAI,CAACO,SAAS,CAAC;AACxC,IAAA,IAAI,CAACf,IAAI,CAACG,eAAe,CAACI,QAAQ,CAACC,IAAI,CAAE,CAAA,EAAEO,SAAU,CAAA,KAAA,CAAM,CAAC;IAC5DV,eAAe,CAACI,0BAA0B,EAAE;IAC5C,IAAI,CAACT,IAAI,CAACqB,iBAAiB,CAAE,CAAEN,EAAAA,SAAU,OAAM,CAAC;AAClD;AAAC,EAAA;IAAAJ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,wBAAA,EAAA,CAfAC,MAAM,CAAA,CAAA;AAAA;EAkBPS,gBAAgBA,CAACN,KAAK,EAAE;AACtB,IAAA,MAAMX,eAAe,GAAG,IAAI,CAACL,IAAI,CAACK,eAAe;IACjD,IAAI,CAACL,IAAI,CAACK,eAAe,CAACE,QAAQ,CAACC,IAAI,CAAC,cAAc,CAAC;IACvD,IAAI,CAACR,IAAI,CAACG,eAAe,CAACI,QAAQ,CAACC,IAAI,CAAC,mBAAmB,CAAC;IAC5DH,eAAe,CAACI,0BAA0B,EAAE;IAC5C,IAAI,CAACT,IAAI,CAACuB,gBAAgB,CACxB,IAAI,CAACC,iBAAiB,CACpBR,KAAK,EACLX,eAAe,CAACC,KAAK,EACrB,IAAI,CAACN,IAAI,CAACG,eACZ,CAAC,EACD,IAAI,CAACH,IAAI,CAACG,eACZ,CAAC;AACH;AAAC,EAAA;IAAAQ,CAAA,CAAA,IAAA,CAAAC,SAAA,EAAA,kBAAA,EAAA,CAdAC,MAAM,CAAA,CAAA;AAAA;AAgBPW,EAAAA,iBAAiBA,CAACR,KAAK,EAAEV,KAAK,EAAEH,eAAe,EAAE;AAC/C,IAAA,IAAIsB,UAAU,GACZ,IAAI,CAACzB,IAAI,CAACC,gBAAgB,CAACF,SAAS,CAACG,GAAG,CAACC,eAAe,CAACC,YAAY,CAAC,IACtE,EAAE;AACJ,IAAA,IAAIqB,UAAU,CAACnB,KAAK,CAAC,KAAKU,KAAK,EAAE;MAC/B,OAAOS,UAAU,CAAC;AACpB;IACAtB,eAAe,CAACuB,gBAAgB,GAAG;AACjCpB,MAAAA,KAAK,EAAEA,KAAK;AACZqB,MAAAA,aAAa,EAAEF,UAAU,CAACnB,KAAK,CAAC;MAChCsB,cAAc,EAAEH,UAAU,CAACI;KAC5B;AAEDJ,IAAAA,UAAU,CAACnB,KAAK,CAAC,GAAGU,KAAK;AACzB,IAAA,OAAOS,UAAU;AACnB;AACF;AAACK,oBAAA,CAAAC,QAAA,EAjEoBnC,eAAe,CAAA;;;;"}