# Action handling

## submitAction

When the user clicks the submit button, 

Optional. Provides `(changeset.data, changesetWebform)` as arguments.

The action you pass can either return a promise, or be a synchronous action. 

### Promise example

In the case of a promise based action, return the promise so that the `ChangesetWebform` component can fire the `submitSuccess` or `submitError` actions where they are passed (See below). 

// TODO interactive

In this example, assume that `fetchPromise` returns a promise.

<Demos::Test />

### Synchronous example

Simply return after completing the synchronous operations, and the `ChnagesetWebform` component will fire the `submitSuccess` action if the operation runs successfully.

If an error is encountered, the `submitError` action will be fired. TODO test this.

```javascript
submitAction(changesetData, changesetWebform) {
  this.prop = changesetData.email;
  return;
}
```

If `submitAction` is not passed, the fallback submit below code will run.

```javascript
changeset.save().then(saveChangesetResponse => {
  changesetWebform.formSettings.set('requestInFlight', false);
  if (this.submitSuccess) {
    this.submitSuccess(saveChangesetResponse, changesetWebform);
  }
  if (changesetWebform.formSettings.clearFormAfterSubmit) {
    this.send('clearForm');
  }
}).catch(error => {
  if (this.submitError) {
    this.submitError(error, changesetWebform);
  }
  changesetWebform.formSettings.set('requestInFlight', false);
});
```

## beforeSubmitAction

Provides `(changesetWebform)` as the only argument. Runs after a user initiates form submission, but before `castAllowedFields` and `submitAction`.

## afterGenerateChangesetWebform 

When the `ChangesetWebform` component is inserted, it calls the util that generates the parses the formSchema and generates an Ember object containing the form field sand settings. Immediately after doing so, it fires this action, providing the `changesetWebform` object as the only argument. The object contains the following properties.

```
{
  fields: // Array of Ember objects, one for each field in the formSchema.
  changeset: // The changeset generated byt he component.
  formSettings: An Ember generated by merging the form specific settings with the global form settings and addon default form settings.
  formSchema: //A copy of the original POJO form schema passed to the  `ChangesetWebform` component.
}
```

This action can be useful for accessing the above properties outside of the form itself. You can then manipulate the form UI and run validations when the user interacts with UI elements outside of the form. The example below validates the name nad email field when the user clicks "Next", which is not a part of the `ChangesetWebform` component.

<Docs::ActionHandling::AfterGenerateChangesetWebformForm />

## afterFieldValidation

Fires every time a field is validated.

It provides `(formField, ChangesetWebform, fieldValidationErrors)` as arguments.

Where there are validation errors, the value of the `fieldValidationErrors` argument takes the form of:

```
{
  value: // value of the changeset prop when validated,
  validation: [ // Array of the validation error messages ]
}
```

<Docs::ActionHandling::AfterFieldValidationForm />

## afterValidateFields

Provides `(changesetWebform, validationResult)` as arguments.

Runs after validating all form fields which are not hidden or cast out. This occurs when the user clicks the submit button, but before submitting the form data.

Validation result is an array with one item for each validated field. For any fields which have validation errors, the item will be an object with the keys `value` and `validation` where validation is the validation error that resulted for that field.

For fields which passed validation, the item will be the value of the field as a string.

## onFieldValueChange

Fires every time a property in the changeset is updated.

It provides `(formField, ChangesetWebform, snapshot)` as arguments.

<!-- TODO explain snapshot -->

<Docs::ActionHandling::onFieldValueChange />

## afterFieldValidation

Runs after an individual field is validated.

Provides `(formField, changesetWebform, fieldValidationErrors)` as arguments.
## onUserInteraction

Fires after any individual field calls the `onUserInteraction` action in the `ValidatingField` component. This occurs anytime a user interacts with a field, whether or not that interaction updates the value of the field. 

Examples include focussing in or out of an input, clicking a clicker element, or click the add clone or remove clone buttons for clonable fields.

It provides `(formField, changesetWebform, eventName, event)` as arguments.

`eventName` is a string, which is the name of the event. This is not necessarily the name of an evenet defined in the JavaScript spec, it is simply chosen so that the particular type of user interaction can be reacted to.

<!-- TODO add all exisitng eventNames in built in fields -->

`event` is the actual JavaScript event object, included where it exists.

<!-- TODO check if event cannot always be sent? -->

<Docs::ActionHandling::OnUserInteractionForm />

--------

## beforeSubmitAction

Runs after the user clicks the submit button, but before the `submitAction` is run.

Send `(changesetWebform)` as the only argument.

## beforeValidation

beforeValidation(field) {

## formValidationFailed

formValidationFailed(changesetWebform) {

## formValidationPassed

formValidationPassed() {

## submitError

submitError(error, formFields, formSettings, changeset) {

## submitSuccess

submitSuccess(response, formFields, formMetaData, changeset) {